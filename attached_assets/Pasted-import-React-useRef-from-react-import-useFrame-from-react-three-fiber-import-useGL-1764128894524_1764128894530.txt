import React, { useRef } from 'react';
import { useFrame } from '@react-three/fiber';
import { useGLTF } from '@react-three/drei';
import * as THREE from 'three';

// Define the props the component accepts
interface PlanetModelProps {
  modelPath: string;       // Path to the .glb file (e.g., '/models/mars.glb')
  position: [number, number, number]; // [x, y, z] coordinates
  scale?: number;          // Optional size multiplier (default to 1)
  rotationSpeed?: number;  // How fast it spins on its axis
  name: string;            // For identifying the object upon clicking
}

const PlanetModel: React.FC<PlanetModelProps> = ({
  modelPath,
  position,
  scale = 1,
  rotationSpeed = 0.001, // Default slow rotation
  name,
}) => {
  const planetRef = useRef<THREE.Group>(null);

  // 1. Load the GLTF model correctly.
  // useGLTF automatically handles caching and Draco decompression if set up.
  const { scene } = useGLTF(modelPath);

  // 2. Enable Shadows
  // We must traverse the imported scene and tell every mesh within it to handle shadows.
  React.useEffect(() => {
    scene.traverse((child) => {
      if ((child as THREE.Mesh).isMesh) {
        child.castShadow = true;
        child.receiveShadow = true;
      }
    });
  }, [scene]);

  // 3. Animation Loop for Axial Rotation
  useFrame((state, delta) => {
    if (planetRef.current) {
      // Rotate around the Y-axis (axial tilt can be added here later)
      planetRef.current.rotation.y += rotationSpeed * delta;
    }
  });

  return (
    <group ref={planetRef} position={position}>
      {/* The primitive object renders the loaded scene.
        We apply scale here so the rotation group stays normalized.
      */}
      <primitive 
        object={scene} 
        scale={[scale, scale, scale]} 
        userData={{ type: 'planet', name: name }} // Useful for raycasting/clicking interactions later
      />
    </group>
  );
};

// Preload the model for performance so it doesn't pop in when first rendered
// Repeat this for all your main planet paths
useGLTF.preload('/models/mercury.glb');
useGLTF.preload('/models/venus.glb');
useGLTF.preload('/models/earth.glb');
// ... add others here

export default PlanetModel;
